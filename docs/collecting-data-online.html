<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 5 Collecting data online | Stanford Spring 2025 Intro to Computational Social Science</title>
  <meta name="description" content="Week 5 Collecting data online | Stanford Spring 2025 Intro to Computational Social Science" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 5 Collecting data online | Stanford Spring 2025 Intro to Computational Social Science" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 5 Collecting data online | Stanford Spring 2025 Intro to Computational Social Science" />
  
  
  

<meta name="author" content="Yuze Sui" />


<meta name="date" content="2025-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="social-network-analysis.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro_Comp_Social_Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>1</b> Intro to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-to-r.html"><a href="intro-to-r.html#r-basics"><i class="fa fa-check"></i><b>1.1</b> R Basics</a></li>
<li class="chapter" data-level="1.2" data-path="intro-to-r.html"><a href="intro-to-r.html#vectors"><i class="fa fa-check"></i><b>1.2</b> Vectors</a></li>
<li class="chapter" data-level="1.3" data-path="intro-to-r.html"><a href="intro-to-r.html#loading-packages"><i class="fa fa-check"></i><b>1.3</b> Loading Packages</a></li>
<li class="chapter" data-level="1.4" data-path="intro-to-r.html"><a href="intro-to-r.html#exploring-and-visualizing-data"><i class="fa fa-check"></i><b>1.4</b> Exploring and Visualizing Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html"><i class="fa fa-check"></i><b>2</b> Surveys and Survey Experiments with Qualtrics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#creating-a-qualtrics-account"><i class="fa fa-check"></i><b>2.2</b> Creating a Qualtrics account</a></li>
<li class="chapter" data-level="2.3" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#survey-options"><i class="fa fa-check"></i><b>2.3</b> Survey options</a></li>
<li class="chapter" data-level="2.4" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#a-quick-survey-experiment"><i class="fa fa-check"></i><b>2.4</b> A quick survey experiment</a></li>
<li class="chapter" data-level="2.5" data-path="surveys-and-survey-experiments-with-qualtrics.html"><a href="surveys-and-survey-experiments-with-qualtrics.html#publish-it"><i class="fa fa-check"></i><b>2.5</b> Publish it!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="regression-and-classification.html"><a href="regression-and-classification.html"><i class="fa fa-check"></i><b>3</b> Regression and Classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="regression-and-classification.html"><a href="regression-and-classification.html#linear-regression"><i class="fa fa-check"></i><b>3.1</b> Linear Regression</a></li>
<li class="chapter" data-level="3.2" data-path="regression-and-classification.html"><a href="regression-and-classification.html#how-linear-regression-works"><i class="fa fa-check"></i><b>3.2</b> How linear regression works</a></li>
<li class="chapter" data-level="3.3" data-path="regression-and-classification.html"><a href="regression-and-classification.html#linear-regression-using-the-lm-function"><i class="fa fa-check"></i><b>3.3</b> Linear regression using the lm function</a></li>
<li class="chapter" data-level="3.4" data-path="regression-and-classification.html"><a href="regression-and-classification.html#multiple-regression"><i class="fa fa-check"></i><b>3.4</b> Multiple Regression</a></li>
<li class="chapter" data-level="3.5" data-path="regression-and-classification.html"><a href="regression-and-classification.html#linear-regression-prediction"><i class="fa fa-check"></i><b>3.5</b> Linear Regression Prediction</a></li>
<li class="chapter" data-level="3.6" data-path="regression-and-classification.html"><a href="regression-and-classification.html#classification-logistic-regression"><i class="fa fa-check"></i><b>3.6</b> Classification (Logistic Regression)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="social-network-analysis.html"><a href="social-network-analysis.html"><i class="fa fa-check"></i><b>4</b> Social Network Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="social-network-analysis.html"><a href="social-network-analysis.html#understanding-network-data-structures-in-r"><i class="fa fa-check"></i><b>4.1</b> Understanding network data structures in R</a></li>
<li class="chapter" data-level="4.2" data-path="social-network-analysis.html"><a href="social-network-analysis.html#visualizing-network-data-in-r"><i class="fa fa-check"></i><b>4.2</b> Visualizing network data in R</a></li>
<li class="chapter" data-level="4.3" data-path="social-network-analysis.html"><a href="social-network-analysis.html#key-network-measures"><i class="fa fa-check"></i><b>4.3</b> Key network measures</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="social-network-analysis.html"><a href="social-network-analysis.html#degree-how-many-friends-do-i-have"><i class="fa fa-check"></i><b>4.3.1</b> Degree (“How many friends do I have?”)</a></li>
<li class="chapter" data-level="4.3.2" data-path="social-network-analysis.html"><a href="social-network-analysis.html#weighted-degree-strength"><i class="fa fa-check"></i><b>4.3.2</b> Weighted degree (strength)</a></li>
<li class="chapter" data-level="4.3.3" data-path="social-network-analysis.html"><a href="social-network-analysis.html#global-clustering-coefficient-gcc"><i class="fa fa-check"></i><b>4.3.3</b> Global Clustering Coefficient (GCC)</a></li>
<li class="chapter" data-level="4.3.4" data-path="social-network-analysis.html"><a href="social-network-analysis.html#average-path-length-apl"><i class="fa fa-check"></i><b>4.3.4</b> Average path length (APL)</a></li>
<li class="chapter" data-level="4.3.5" data-path="social-network-analysis.html"><a href="social-network-analysis.html#assortativity"><i class="fa fa-check"></i><b>4.3.5</b> Assortativity</a></li>
<li class="chapter" data-level="4.3.6" data-path="social-network-analysis.html"><a href="social-network-analysis.html#betweenness-centrality"><i class="fa fa-check"></i><b>4.3.6</b> Betweenness centrality</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="social-network-analysis.html"><a href="social-network-analysis.html#visualizing-key-measures"><i class="fa fa-check"></i><b>4.4</b> Visualizing Key Measures</a></li>
<li class="chapter" data-level="4.5" data-path="social-network-analysis.html"><a href="social-network-analysis.html#benchmark-our-empirical-network"><i class="fa fa-check"></i><b>4.5</b> Benchmark our empirical network</a></li>
<li class="chapter" data-level="4.6" data-path="social-network-analysis.html"><a href="social-network-analysis.html#find-local-clusterscommunities"><i class="fa fa-check"></i><b>4.6</b> Find local clusters/communities</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="social-network-analysis.html"><a href="social-network-analysis.html#other-resources"><i class="fa fa-check"></i><b>4.6.1</b> Other Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="collecting-data-online.html"><a href="collecting-data-online.html"><i class="fa fa-check"></i><b>5</b> Collecting data online</a>
<ul>
<li class="chapter" data-level="5.1" data-path="collecting-data-online.html"><a href="collecting-data-online.html#scraping-the-web"><i class="fa fa-check"></i><b>5.1</b> Scraping the web</a></li>
<li class="chapter" data-level="5.2" data-path="collecting-data-online.html"><a href="collecting-data-online.html#google-news-api"><i class="fa fa-check"></i><b>5.2</b> Google News API</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="collecting-data-online.html"><a href="collecting-data-online.html#prerequistes"><i class="fa fa-check"></i><b>5.2.1</b> Prerequistes</a></li>
<li class="chapter" data-level="5.2.2" data-path="collecting-data-online.html"><a href="collecting-data-online.html#get-started"><i class="fa fa-check"></i><b>5.2.2</b> Get started</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stanford Spring 2025 Intro to Computational Social Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="collecting-data-online" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Week 5</span> Collecting data online<a href="collecting-data-online.html#collecting-data-online" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>This section is drafted based on Dr. Mark Hoffman’s previous SOC 10 lab notes.</em>
<em>Conducting research via webpage scrapping and API call is likely under the regulation of University IRB board. Please consult Stanford IRB office for detail.</em></p>
<p>In previous tutorials, we learned how to download datasets online or collect them ourselves using survey software like Qualtrics and to load them into R for analysis. A lot of computational social science data, however, doesn’t come in such easily downloadable form. This is for a couple reasons. For one, companies might provide their data for viewing on a webpage rather than in a .csv or .dta file. Wikipedia, for example, contains thousands and thousands of data tables, concerning topics from GDP per capita by country to the number and types of awards won by Kanye West. These data are publicly available in the form of tables on their various webpages; but there is no single place where you can download all of them. We therefore will need to learn how to grab this data off their webpages using something called web scraping or crawling in R. This is, in part, what Google uses to index the content of websites and offer them to you following your searches.</p>
<p>Alternatively, the amount of data that a website provides might just be too large or too heterogenous to reasonably put into a single, downloadable file or else webistes might have privacy and intellectual property concerns, which preclude them from making all of their data easily available to everyone. In such situations, a webiste or organization might provide a tool for accessing their data in an approved fashion, often referred to as an application programming interface (API).</p>
<p>In tutorial, we will learn the aforementioned skills for collecting online data - web scraping and using APIs. Each website and API is different, so the tutorials presented here might not always apply precisely to every use case, but the basic principles should help get you started collecting digital trace data.</p>
<div id="scraping-the-web" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Scraping the web<a href="collecting-data-online.html#scraping-the-web" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the first portion of this tutorial, we will cover web scraping. Web scraping involves pulling the underlying code – HTML, CSS, or Javascript – of website and interpreting or collecting information embedded in that code. When you visit a website, your browser reads the HTML, CSS, and Javascript and through interpreting them, learns how to display that website. HTML defines the meaning and structure of web content, while CSS (Cascading Style Sheets) and Javascript in turn define how that content appears and behaves, respectively.</p>
<p>One of the best packages in R for webscraping is rvest. In particular, it focuses on pulling data from html web pages and has a number of functions for doing so. You could build a program which grabs the HTML from websites and searches through it for information, but it would be very difficult. rvest has done the difficult work for you.</p>
<p>Let’s begin by installing rvest.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="collecting-data-online.html#cb97-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rvest&quot;</span>)</span></code></pre></div>
<p>Now we can load it into R. Let’s load in tidyverse too.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="collecting-data-online.html#cb98-1" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb98-2"><a href="collecting-data-online.html#cb98-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Great! If you want to read more about rvest beyond what is covered here, check out its reference manual online: <a href="https://cran.r-project.org/web/packages/rvest/rvest.pdf" class="uri">https://cran.r-project.org/web/packages/rvest/rvest.pdf</a></p>
<p>The core function in rvest for grabbing the html data from a website is html(). We will use it to grab data from Wikipedia about the GDP per person employed. We could grab any webpage using this function and it is worth exploring on your own time.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="collecting-data-online.html#cb99-1" tabindex="-1"></a>webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(PPP)_per_person_employed&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="collecting-data-online.html#cb100-1" tabindex="-1"></a>webpage</span></code></pre></div>
<p>You should be able to see the below output:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="collecting-data-online.html#cb101-1" tabindex="-1"></a>{html_document}</span>
<span id="cb101-2"><a href="collecting-data-online.html#cb101-2" tabindex="-1"></a><span class="sc">&lt;</span>html class<span class="ot">=</span><span class="st">&quot;client-nojs vector-feature-language-in-header-enabled vector-feature-language-in-main-page-header-disabled vector-feature-page-tools-pinned-disabled vector-feature-toc-pinned-clientpref-1 vector-feature-main-menu-pinned-disabled vector-feature-limited-width-clientpref-1 vector-feature-limited-width-content-enabled vector-feature-custom-font-size-clientpref-1 vector-feature-appearance-pinned-clientpref-1 vector-feature-night-mode-enabled skin-theme-clientpref-day vector-sticky-header-enabled vector-toc-available&quot;</span> lang<span class="ot">=</span><span class="st">&quot;en&quot;</span> dir<span class="ot">=</span><span class="st">&quot;ltr&quot;</span><span class="sc">&gt;</span></span>
<span id="cb101-3"><a href="collecting-data-online.html#cb101-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">&lt;</span>head<span class="sc">&gt;</span>\n<span class="sc">&lt;</span>meta http<span class="sc">-</span>equiv<span class="ot">=</span><span class="st">&quot;Content-Type&quot;</span> content<span class="ot">=</span><span class="st">&quot;text/html; chars ...</span></span>
<span id="cb101-4"><a href="collecting-data-online.html#cb101-4" tabindex="-1"></a><span class="st">[2] &lt;body class=&quot;</span>skin<span class="sc">--</span>responsive skin<span class="sc">-</span>vector skin<span class="sc">-</span>vector<span class="sc">-</span>search<span class="sc">-</span>vue  ...</span></code></pre></div>
<p>Cool! With the HTML in our R environment, we can now use other functions to extract information from it. How do we do that?</p>
<p>Well first, we have to know what function to use. There are quite a few - for example, html_attr extracts text or tag names, html_nodes extracts sections or divisions of the html file by name or type, html_table extracts tables inside of sections, and html_text extracts text.</p>
<p>Once we know the function that we need to use, then we have to figure out what we want to pull from the html.</p>
<ol style="list-style-type: decimal">
<li><p>Go to our URL: <a href="https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(PPP)_per_person_employed" class="uri">https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(PPP)_per_person_employed</a></p></li>
<li><p>Find the table to extract.</p></li>
<li><p>Right-click the table -&gt; click Inspect</p></li>
<li><p>A pop-up menu will show and you will need to select the table element</p></li>
<li><p>Right-click the table element -&gt; Copy -&gt; Copy Xpath</p></li>
</ol>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="collecting-data-online.html#cb102-1" tabindex="-1"></a>webpage_table_html <span class="ot">&lt;-</span><span class="fu">html_nodes</span>(webpage, <span class="at">xpath=</span><span class="st">&#39;/html/body/div[2]/div/div[3]/main/div[3]/div[3]/div[1]/table/tbody/tr[2]/td[1]/table&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="collecting-data-online.html#cb103-1" tabindex="-1"></a>webpage_table_html</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="collecting-data-online.html#cb104-1" tabindex="-1"></a>{<span class="fu">xml_nodeset</span> (<span class="dv">1</span>)}</span>
<span id="cb104-2"><a href="collecting-data-online.html#cb104-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">&lt;</span>table class<span class="ot">=</span><span class="st">&quot;wikitable sortable&quot;</span> style<span class="ot">=</span><span class="st">&quot;margin-left:auto;margin- ...</span></span></code></pre></div>
<p>The problem is that the table is still in html format - thankfully, rvest has a function, html_table, which converts such information into an R data.frame. It saves each table in the html as a data.frame inside of a single list, so we will have to index the list we want. In this case, there is only one table on the page so we will index the first item of the list.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="collecting-data-online.html#cb105-1" tabindex="-1"></a>gdp_info <span class="ot">&lt;-</span> <span class="fu">html_table</span>(webpage_table_html, <span class="at">fill =</span> T, <span class="at">trim =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="collecting-data-online.html#cb106-1" tabindex="-1"></a><span class="fu">class</span>(gdp_info)</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="collecting-data-online.html#cb107-1" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;list&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="collecting-data-online.html#cb108-1" tabindex="-1"></a>gdp_info <span class="ot">&lt;-</span> gdp_info[[<span class="dv">1</span>]]</span></code></pre></div>
<p>There isn’t much we can do with a single column of data like this. So what if we scraped data about countries from another Wikipedia page and merged it to this one? For example, we could evaluate if GDP per hour worked (which implicitly adjusts for country size and captures hourly returns to labor) is correlated with how a country performed at the 2016 Olympic games.</p>
<p>First let’s grab the info just like we did before.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="collecting-data-online.html#cb109-1" tabindex="-1"></a><span class="co"># Grab the html</span></span>
<span id="cb109-2"><a href="collecting-data-online.html#cb109-2" tabindex="-1"></a>olympics_webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/2024_Summer_Olympics_medal_table&quot;</span>)</span>
<span id="cb109-3"><a href="collecting-data-online.html#cb109-3" tabindex="-1"></a><span class="co"># Extract the table</span></span>
<span id="cb109-4"><a href="collecting-data-online.html#cb109-4" tabindex="-1"></a>olympics_webpage_table_html <span class="ot">&lt;-</span><span class="fu">html_nodes</span>(olympics_webpage, <span class="at">xpath=</span><span class="st">&#39;/html/body/div[2]/div/div[3]/main/div[3]/div[3]/div[1]/table[3]&#39;</span>)</span>
<span id="cb109-5"><a href="collecting-data-online.html#cb109-5" tabindex="-1"></a><span class="co"># Convert the table to a data.frame</span></span>
<span id="cb109-6"><a href="collecting-data-online.html#cb109-6" tabindex="-1"></a>medals_info <span class="ot">&lt;-</span> <span class="fu">html_table</span>(olympics_webpage_table_html, <span class="at">fill =</span> T, <span class="at">trim =</span> T)</span>
<span id="cb109-7"><a href="collecting-data-online.html#cb109-7" tabindex="-1"></a>medals_info <span class="ot">&lt;-</span> medals_info[[<span class="dv">1</span>]]</span></code></pre></div>
<p>Then let’s inspect the data. Does it look like it can be easily merged with our GDP data? Perhaps, but there is one problem. Some countries (e.g., United States and France ) have special symbols after their names.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="collecting-data-online.html#cb110-1" tabindex="-1"></a><span class="co"># also need tidyverse pakacge </span></span>
<span id="cb110-2"><a href="collecting-data-online.html#cb110-2" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb110-3"><a href="collecting-data-online.html#cb110-3" tabindex="-1"></a></span>
<span id="cb110-4"><a href="collecting-data-online.html#cb110-4" tabindex="-1"></a>medals_info <span class="ot">&lt;-</span> medals_info <span class="sc">%&gt;%</span> </span>
<span id="cb110-5"><a href="collecting-data-online.html#cb110-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb110-6"><a href="collecting-data-online.html#cb110-6" tabindex="-1"></a>    <span class="at">NOC =</span> NOC <span class="sc">%&gt;%</span> </span>
<span id="cb110-7"><a href="collecting-data-online.html#cb110-7" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">&quot;[^[:alpha:][:space:]]&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># keep only letters &amp; spaces</span></span>
<span id="cb110-8"><a href="collecting-data-online.html#cb110-8" tabindex="-1"></a>      <span class="fu">str_to_lower</span>() <span class="sc">%&gt;%</span>                           <span class="co"># convert to lowercase</span></span>
<span id="cb110-9"><a href="collecting-data-online.html#cb110-9" tabindex="-1"></a>      <span class="fu">str_squish</span>()                                 <span class="co"># trim / collapse spaces</span></span>
<span id="cb110-10"><a href="collecting-data-online.html#cb110-10" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="collecting-data-online.html#cb111-1" tabindex="-1"></a><span class="fu">head</span>(medals_info)</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="collecting-data-online.html#cb112-1" tabindex="-1"></a><span class="co"># A tibble: 6 × 6</span></span>
<span id="cb112-2"><a href="collecting-data-online.html#cb112-2" tabindex="-1"></a>  Rank  NOC            Gold Silver Bronze Total</span>
<span id="cb112-3"><a href="collecting-data-online.html#cb112-3" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>         <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span>  <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span></span>
<span id="cb112-4"><a href="collecting-data-online.html#cb112-4" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1</span>     united states    <span class="dv">40</span>     <span class="dv">44</span>     <span class="dv">42</span> <span class="dv">126</span>  </span>
<span id="cb112-5"><a href="collecting-data-online.html#cb112-5" tabindex="-1"></a><span class="dv">2</span> <span class="dv">2</span>     china            <span class="dv">40</span>     <span class="dv">27</span>     <span class="dv">24</span> <span class="dv">91</span>   </span>
<span id="cb112-6"><a href="collecting-data-online.html#cb112-6" tabindex="-1"></a><span class="dv">3</span> <span class="dv">3</span>     japan            <span class="dv">20</span>     <span class="dv">12</span>     <span class="dv">13</span> <span class="dv">45</span>   </span>
<span id="cb112-7"><a href="collecting-data-online.html#cb112-7" tabindex="-1"></a><span class="dv">4</span> <span class="dv">4</span>     australia        <span class="dv">18</span>     <span class="dv">19</span>     <span class="dv">16</span> <span class="dv">53</span>   </span>
<span id="cb112-8"><a href="collecting-data-online.html#cb112-8" tabindex="-1"></a><span class="dv">5</span> <span class="dv">5</span>     france           <span class="dv">16</span>     <span class="dv">26</span>     <span class="dv">22</span> <span class="dv">64</span>   </span>
<span id="cb112-9"><a href="collecting-data-online.html#cb112-9" tabindex="-1"></a><span class="dv">6</span> <span class="dv">6</span>     netherlands      <span class="dv">15</span>      <span class="dv">7</span>     <span class="dv">12</span> <span class="dv">34</span>   </span></code></pre></div>
<p>Let’s do the same for our GDP data</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="collecting-data-online.html#cb113-1" tabindex="-1"></a>gdp_info <span class="ot">&lt;-</span> gdp_info <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="collecting-data-online.html#cb113-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-3"><a href="collecting-data-online.html#cb113-3" tabindex="-1"></a>    <span class="at">Country =</span> Country <span class="sc">%&gt;%</span> </span>
<span id="cb113-4"><a href="collecting-data-online.html#cb113-4" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">&quot;[^[:alpha:][:space:]]&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># keep only letters &amp; spaces</span></span>
<span id="cb113-5"><a href="collecting-data-online.html#cb113-5" tabindex="-1"></a>      <span class="fu">str_to_lower</span>() <span class="sc">%&gt;%</span>                           <span class="co"># convert to lowercase</span></span>
<span id="cb113-6"><a href="collecting-data-online.html#cb113-6" tabindex="-1"></a>      <span class="fu">str_squish</span>()                                 <span class="co"># trim / collapse spaces</span></span>
<span id="cb113-7"><a href="collecting-data-online.html#cb113-7" tabindex="-1"></a>  )</span></code></pre></div>
<p>Now that both datasets have the same way of writing country names, we can merge the data by Country.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="collecting-data-online.html#cb114-1" tabindex="-1"></a>merged_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(gdp_info, medals_info, <span class="at">by.x =</span> <span class="st">&quot;Country&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;NOC&quot;</span>)</span></code></pre></div>
<p>Take a look at the size of merged_df on your Environment panel. What you notice? It only contains 82 rows. Why? This is because only 82 countries have both GDP and medal infromation.</p>
<p>Alternatively, if you want to keep all countries which appeared in the GDP table, you can</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="collecting-data-online.html#cb115-1" tabindex="-1"></a>merged_df_gdp <span class="ot">&lt;-</span> <span class="fu">merge</span>(gdp_info, medals_info, <span class="at">by.x =</span> <span class="st">&quot;Country&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;NOC&quot;</span>,<span class="at">all.x=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>And we can plot results using ggplot, just like we did in our first R lesson! First, let’s select the columns we want using tidyverse.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="collecting-data-online.html#cb116-1" tabindex="-1"></a>merged_df <span class="ot">&lt;-</span> merged_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,<span class="st">`</span><span class="at">GDP per personemployed(2017 Intl. $)</span><span class="st">`</span>,Total,Gold) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Country =</span> Country,<span class="at">GDP_22 =</span> <span class="st">`</span><span class="at">GDP per personemployed(2017 Intl. $)</span><span class="st">`</span>,<span class="at">Total_Medal_24 =</span> Total, <span class="at">Gold_24 =</span> Gold)</span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="collecting-data-online.html#cb117-1" tabindex="-1"></a><span class="fu">head</span>(merged_df)</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="collecting-data-online.html#cb118-1" tabindex="-1"></a>  Country  GDP_22 Total_Medal_24 Gold_24</span>
<span id="cb118-2"><a href="collecting-data-online.html#cb118-2" tabindex="-1"></a><span class="dv">1</span>   albania  <span class="dv">34</span>,<span class="dv">018</span>              <span class="dv">2</span>       <span class="dv">0</span></span>
<span id="cb118-3"><a href="collecting-data-online.html#cb118-3" tabindex="-1"></a><span class="dv">2</span>   algeria  <span class="dv">45</span>,<span class="dv">619</span>              <span class="dv">3</span>       <span class="dv">2</span></span>
<span id="cb118-4"><a href="collecting-data-online.html#cb118-4" tabindex="-1"></a><span class="dv">3</span> argentina  <span class="dv">52</span>,<span class="dv">012</span>              <span class="dv">3</span>       <span class="dv">1</span></span>
<span id="cb118-5"><a href="collecting-data-online.html#cb118-5" tabindex="-1"></a><span class="dv">4</span>   armenia  <span class="dv">34</span>,<span class="dv">869</span>              <span class="dv">4</span>       <span class="dv">0</span></span>
<span id="cb118-6"><a href="collecting-data-online.html#cb118-6" tabindex="-1"></a><span class="dv">5</span> australia  <span class="dv">97</span>,<span class="dv">250</span>             <span class="dv">53</span>      <span class="dv">18</span></span>
<span id="cb118-7"><a href="collecting-data-online.html#cb118-7" tabindex="-1"></a><span class="dv">6</span>   austria <span class="dv">112</span>,<span class="dv">589</span>              <span class="dv">5</span>       <span class="dv">2</span></span></code></pre></div>
<p>Let’s plot now!</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="collecting-data-online.html#cb119-1" tabindex="-1"></a><span class="fu">ggplot</span>(merged_df, <span class="fu">aes</span>(<span class="at">x =</span> GDP_22, </span>
<span id="cb119-2"><a href="collecting-data-online.html#cb119-2" tabindex="-1"></a>                      <span class="at">y =</span> Gold_24, </span>
<span id="cb119-3"><a href="collecting-data-online.html#cb119-3" tabindex="-1"></a>                      <span class="at">label =</span> Country)) <span class="sc">+</span> </span>
<span id="cb119-4"><a href="collecting-data-online.html#cb119-4" tabindex="-1"></a>                      <span class="fu">geom_text</span>() <span class="sc">+</span> </span>
<span id="cb119-5"><a href="collecting-data-online.html#cb119-5" tabindex="-1"></a>                      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">formula=</span> y<span class="sc">~</span>x)</span></code></pre></div>
<p><img src="week5_plot1.png" /></p>
<p>This plot is terrible! What is up with the x-axis? It doesn’t seem to be detecting either axis as numbers. Let’s convert them using as.numeric so that R doesn’t get confused again. There is a problem though.. the GDP values have commas in them. R won’t recognize them as potential numbers and will return NA when we run as.numeric. We can use the gsub function to substitute things in a string for something else. Let’s use it to remove the commas by substituting commas with empty strings.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="collecting-data-online.html#cb120-1" tabindex="-1"></a>merged_df<span class="sc">$</span>GDP_22 <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>, merged_df<span class="sc">$</span>GDP_22)</span>
<span id="cb120-2"><a href="collecting-data-online.html#cb120-2" tabindex="-1"></a>merged_df<span class="sc">$</span>GDP_22 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(merged_df<span class="sc">$</span>GDP_22)</span></code></pre></div>
<p>Let’s try again!</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="collecting-data-online.html#cb121-1" tabindex="-1"></a><span class="fu">ggplot</span>(merged_df, <span class="fu">aes</span>(<span class="at">x =</span> GDP_22, </span>
<span id="cb121-2"><a href="collecting-data-online.html#cb121-2" tabindex="-1"></a>                      <span class="at">y =</span> Gold_24, </span>
<span id="cb121-3"><a href="collecting-data-online.html#cb121-3" tabindex="-1"></a>                      <span class="at">label =</span> Country)) <span class="sc">+</span> </span>
<span id="cb121-4"><a href="collecting-data-online.html#cb121-4" tabindex="-1"></a>                      <span class="fu">geom_text</span>() <span class="sc">+</span> </span>
<span id="cb121-5"><a href="collecting-data-online.html#cb121-5" tabindex="-1"></a>                      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">formula=</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb121-6"><a href="collecting-data-online.html#cb121-6" tabindex="-1"></a>                      <span class="fu">xlab</span>(<span class="st">&quot;GDP per person employed&quot;</span>)</span></code></pre></div>
<p><img src="week5_plot2.png" /></p>
<p>What do you see? Seems like there is a positive correlation between the two! Let’s
also fit a simple linear regression on it!</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="collecting-data-online.html#cb122-1" tabindex="-1"></a>Model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Gold_24 <span class="sc">~</span> GDP_22, <span class="at">data =</span> merged_df)</span></code></pre></div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="collecting-data-online.html#cb123-1" tabindex="-1"></a><span class="fu">summary</span>(Model1)</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="collecting-data-online.html#cb124-1" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb124-2"><a href="collecting-data-online.html#cb124-2" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> Gold_24 <span class="sc">~</span> GDP_22, <span class="at">data =</span> merged_df)</span>
<span id="cb124-3"><a href="collecting-data-online.html#cb124-3" tabindex="-1"></a></span>
<span id="cb124-4"><a href="collecting-data-online.html#cb124-4" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb124-5"><a href="collecting-data-online.html#cb124-5" tabindex="-1"></a>   Min     <span class="dv">1</span>Q Median     <span class="dv">3</span>Q    Max </span>
<span id="cb124-6"><a href="collecting-data-online.html#cb124-6" tabindex="-1"></a><span class="sc">-</span><span class="fl">7.992</span> <span class="sc">-</span><span class="fl">2.786</span> <span class="sc">-</span><span class="fl">1.710</span> <span class="sc">-</span><span class="fl">0.210</span> <span class="fl">37.568</span> </span>
<span id="cb124-7"><a href="collecting-data-online.html#cb124-7" tabindex="-1"></a></span>
<span id="cb124-8"><a href="collecting-data-online.html#cb124-8" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb124-9"><a href="collecting-data-online.html#cb124-9" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)  </span>
<span id="cb124-10"><a href="collecting-data-online.html#cb124-10" tabindex="-1"></a>(Intercept) <span class="fl">9.846e-01</span>  <span class="fl">1.401e+00</span>   <span class="fl">0.703</span>   <span class="fl">0.4843</span>  </span>
<span id="cb124-11"><a href="collecting-data-online.html#cb124-11" tabindex="-1"></a>GDP_22      <span class="fl">4.235e-05</span>  <span class="fl">1.872e-05</span>   <span class="fl">2.262</span>   <span class="fl">0.0264</span> <span class="sc">*</span></span>
<span id="cb124-12"><a href="collecting-data-online.html#cb124-12" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb124-13"><a href="collecting-data-online.html#cb124-13" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> ‘<span class="sc">**</span><span class="er">*</span>’ <span class="fl">0.001</span> ‘<span class="sc">**</span>’ <span class="fl">0.01</span> ‘<span class="sc">*</span>’ <span class="fl">0.05</span> ‘.’ <span class="fl">0.1</span> ‘ ’ <span class="dv">1</span></span>
<span id="cb124-14"><a href="collecting-data-online.html#cb124-14" tabindex="-1"></a></span>
<span id="cb124-15"><a href="collecting-data-online.html#cb124-15" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">6.963</span> on <span class="dv">80</span> degrees of freedom</span>
<span id="cb124-16"><a href="collecting-data-online.html#cb124-16" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.06012</span>,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.04837</span> </span>
<span id="cb124-17"><a href="collecting-data-online.html#cb124-17" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">5.117</span> on <span class="dv">1</span> and <span class="dv">80</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.0264</span></span></code></pre></div>
<p>The explanatory power of GDP per capita is weak! What other factors you can think of that contribute to the number of gold medals?</p>
<p>What if we exclude China and United States?</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="collecting-data-online.html#cb125-1" tabindex="-1"></a>merged_df_filtered <span class="ot">&lt;-</span> merged_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">!=</span> <span class="st">&quot;china&quot;</span> <span class="sc">&amp;</span> Country <span class="sc">!=</span> <span class="st">&quot;united states&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="collecting-data-online.html#cb126-1" tabindex="-1"></a><span class="fu">ggplot</span>(merged_df_filtered, <span class="fu">aes</span>(<span class="at">x =</span> GDP_22, </span>
<span id="cb126-2"><a href="collecting-data-online.html#cb126-2" tabindex="-1"></a>                      <span class="at">y =</span> Gold_24, </span>
<span id="cb126-3"><a href="collecting-data-online.html#cb126-3" tabindex="-1"></a>                      <span class="at">label =</span> Country)) <span class="sc">+</span> </span>
<span id="cb126-4"><a href="collecting-data-online.html#cb126-4" tabindex="-1"></a>                      <span class="fu">geom_text</span>() <span class="sc">+</span> </span>
<span id="cb126-5"><a href="collecting-data-online.html#cb126-5" tabindex="-1"></a>                      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&#39;lm&#39;</span>, <span class="at">formula=</span> y<span class="sc">~</span>x) <span class="sc">+</span></span>
<span id="cb126-6"><a href="collecting-data-online.html#cb126-6" tabindex="-1"></a>                      <span class="fu">xlab</span>(<span class="st">&quot;GDP per person employed&quot;</span>)</span></code></pre></div>
<p><img src="week5_plot3.png" /></p>
<p>The pattern is still far from linear.</p>
</div>
<div id="google-news-api" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Google News API<a href="collecting-data-online.html#google-news-api" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>This section is drafted based on <a href="https://paulcbauer.github.io/apis_for_social_scientists_a_review/google-news-api.html" class="uri">https://paulcbauer.github.io/apis_for_social_scientists_a_review/google-news-api.html</a>.</em></p>
<p>Google News API allows you to extract news headlines and contents from various global news sources.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="collecting-data-online.html#cb127-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&#39;httr&#39;</span>)</span>
<span id="cb127-2"><a href="collecting-data-online.html#cb127-2" tabindex="-1"></a><span class="fu">library</span>(httr)</span></code></pre></div>
<div id="prerequistes" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Prerequistes<a href="collecting-data-online.html#prerequistes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You need an API key, which can be requested via <a href="https://newsapi.org/register" class="uri">https://newsapi.org/register</a>.
Note that there are a set of limitations for the free version. You can purchase a paid version for better service. But a free version is good enough for this lab’s deomonstration!</p>
</div>
<div id="get-started" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Get started<a href="collecting-data-online.html#get-started" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The API has three main endpoints:
<a href="https://newsapi.org/v2/everything" class="uri">https://newsapi.org/v2/everything</a>?, documented at <a href="https://newsapi.org/docs/endpoints/everything" class="uri">https://newsapi.org/docs/endpoints/everything</a></p>
<p><a href="https://newsapi.org/v2/top-headlines/sources" class="uri">https://newsapi.org/v2/top-headlines/sources</a>?, documented at <a href="https://newsapi.org/docs/endpoints/sources" class="uri">https://newsapi.org/docs/endpoints/sources</a></p>
<p><a href="https://newsapi.org/v2/top-headlines" class="uri">https://newsapi.org/v2/top-headlines</a>?, documented at <a href="https://newsapi.org/docs/endpoints/top-headlines" class="uri">https://newsapi.org/docs/endpoints/top-headlines</a></p>
<p>Let’s try to use the everything endpoint to search for keyword “Canada”</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="collecting-data-online.html#cb128-1" tabindex="-1"></a>endpoint_url <span class="ot">&lt;-</span> <span class="st">&quot;https://newsapi.org/v2/everything?&quot;</span></span>
<span id="cb128-2"><a href="collecting-data-online.html#cb128-2" tabindex="-1"></a>my_query <span class="ot">&lt;-</span> <span class="st">&quot;canada&quot;</span></span>
<span id="cb128-3"><a href="collecting-data-online.html#cb128-3" tabindex="-1"></a>my_start_date <span class="ot">&lt;-</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">7</span></span>
<span id="cb128-4"><a href="collecting-data-online.html#cb128-4" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">NEWS_API_KEY =</span> <span class="st">&quot;89610f37b61a43c389d3830aebff2a81&quot;</span>) <span class="co">#change to your actual API key</span></span>
<span id="cb128-5"><a href="collecting-data-online.html#cb128-5" tabindex="-1"></a>my_api_key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">&quot;NEWS_API_KEY&quot;</span>) </span>
<span id="cb128-6"><a href="collecting-data-online.html#cb128-6" tabindex="-1"></a></span>
<span id="cb128-7"><a href="collecting-data-online.html#cb128-7" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb128-8"><a href="collecting-data-online.html#cb128-8" tabindex="-1"></a>  <span class="st">&quot;q&quot;</span> <span class="ot">=</span> my_query,</span>
<span id="cb128-9"><a href="collecting-data-online.html#cb128-9" tabindex="-1"></a>  <span class="st">&quot;from&quot;</span> <span class="ot">=</span> my_start_date,</span>
<span id="cb128-10"><a href="collecting-data-online.html#cb128-10" tabindex="-1"></a>  <span class="st">&quot;language&quot;</span> <span class="ot">=</span> <span class="st">&quot;en&quot;</span>,</span>
<span id="cb128-11"><a href="collecting-data-online.html#cb128-11" tabindex="-1"></a>  <span class="st">&quot;sortBy&quot;</span> <span class="ot">=</span> <span class="st">&quot;publishedAt&quot;</span>)</span>
<span id="cb128-12"><a href="collecting-data-online.html#cb128-12" tabindex="-1"></a></span>
<span id="cb128-13"><a href="collecting-data-online.html#cb128-13" tabindex="-1"></a>news <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> endpoint_url, </span>
<span id="cb128-14"><a href="collecting-data-online.html#cb128-14" tabindex="-1"></a>               httr<span class="sc">::</span><span class="fu">add_headers</span>(<span class="at">Authorization =</span> my_api_key),</span>
<span id="cb128-15"><a href="collecting-data-online.html#cb128-15" tabindex="-1"></a>               <span class="at">query =</span> params)</span>
<span id="cb128-16"><a href="collecting-data-online.html#cb128-16" tabindex="-1"></a></span>
<span id="cb128-17"><a href="collecting-data-online.html#cb128-17" tabindex="-1"></a>result <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">content</span>(news) </span></code></pre></div>
<p>Let’s see the articles we get!</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="collecting-data-online.html#cb129-1" tabindex="-1"></a>second_article <span class="ot">&lt;-</span> result<span class="sc">$</span>articles[[<span class="dv">2</span>]]  </span>
<span id="cb129-2"><a href="collecting-data-online.html#cb129-2" tabindex="-1"></a>second_article<span class="sc">$</span>title</span>
<span id="cb129-3"><a href="collecting-data-online.html#cb129-3" tabindex="-1"></a>second_article<span class="sc">$</span>url</span>
<span id="cb129-4"><a href="collecting-data-online.html#cb129-4" tabindex="-1"></a>second_article<span class="sc">$</span>source</span>
<span id="cb129-5"><a href="collecting-data-online.html#cb129-5" tabindex="-1"></a>second_article<span class="sc">$</span>description</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="collecting-data-online.html#cb130-1" tabindex="-1"></a><span class="sc">&gt;</span> second_article<span class="sc">$</span>title</span>
<span id="cb130-2"><a href="collecting-data-online.html#cb130-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Amazon launches its first internet satellites to compete against SpaceX’s Starlinks&quot;</span></span>
<span id="cb130-3"><a href="collecting-data-online.html#cb130-3" tabindex="-1"></a><span class="sc">&gt;</span> second_article<span class="sc">$</span>url</span>
<span id="cb130-4"><a href="collecting-data-online.html#cb130-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;https://financialpost.com/pmn/amazon-launches-its-first-internet-satellites-to-compete-against-spacexs-starlinks&quot;</span></span>
<span id="cb130-5"><a href="collecting-data-online.html#cb130-5" tabindex="-1"></a><span class="sc">&gt;</span> second_article<span class="sc">$</span>source</span>
<span id="cb130-6"><a href="collecting-data-online.html#cb130-6" tabindex="-1"></a><span class="sc">$</span>id</span>
<span id="cb130-7"><a href="collecting-data-online.html#cb130-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;financial-post&quot;</span></span>
<span id="cb130-8"><a href="collecting-data-online.html#cb130-8" tabindex="-1"></a></span>
<span id="cb130-9"><a href="collecting-data-online.html#cb130-9" tabindex="-1"></a><span class="sc">$</span>name</span>
<span id="cb130-10"><a href="collecting-data-online.html#cb130-10" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Financial Post&quot;</span></span>
<span id="cb130-11"><a href="collecting-data-online.html#cb130-11" tabindex="-1"></a></span>
<span id="cb130-12"><a href="collecting-data-online.html#cb130-12" tabindex="-1"></a><span class="sc">&gt;</span> second_article<span class="sc">$</span>description</span>
<span id="cb130-13"><a href="collecting-data-online.html#cb130-13" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;CAPE CANAVERAL, Fla. (AP) — Amazon’s first batch of internet satellites rocketed into orbit Monday, the latest entry in the mega constellation market currently dominated by SpaceX’s thousands of Starlinks. The United Launch Alliance’s Atlas V rocket carried u…&quot;</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="social-network-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yuzesui97/soc10_2025spring/edit/main/06-Collect_Data_Online.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/yuzesui97/soc10_2025spring/blob/main/06-Collect_Data_Online.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
